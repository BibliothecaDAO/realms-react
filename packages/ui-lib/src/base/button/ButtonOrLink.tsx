import clsx from 'clsx';
import Link from 'next/link';
import { useRouter } from 'next/router';
import type {
  ComponentPropsWithRef,
  ReactElement,
  ReactNode,
  PropsWithChildren,
} from 'react';
import { forwardRef } from 'react';
import { twMerge } from 'tailwind-merge';
import { Spinner } from '../spinner';

const STYLES = {
  icon: 'rounded-2xl border-gray-600 text-gray-200 ',
  base: 'relative inline-flex items-center justify-center outline-none select-none text-left outline-none rounded transition duration-150 ease-in-out capitalize hover:-translate-y-0.5',
  active:
    'focus-visible:ring focus-visible:ring-offset-2 focus-visible:ring-offset-white',
  disabled: 'disabled:opacity-70 disabled:pointer-events-none',
  size: {
    base: {
      xs: 'py-1 px-4 text-xs',
      sm: 'py-2 px-4 text-sm',
      md: 'py-2 px-4 text-md',
      lg: 'py-2 px-4 text-lg',
    },
    icon: {
      xs: 'p-1 text-xs',
      sm: 'p-2 text-sm',
      md: 'p-3 text-md',
      lg: 'p-4 text-lg',
    },
  },
  variant: {
    default:
      'text-gray-600 bg-gray-100 hover:bg-gray-200 active:bg-gray-300 active:text-gray-900 hover:text-gray-900 border-0',
    attack:
      'text-red-600 bg-red-400 hover:bg-red-500 active:bg-red-300 active:text-red-900 hover:text-red-900 text-white border-red-300 hover:text-red-200',
    primary: 'primary-button-color shadow-lg active:border-transparent',
    secondary:
      ' text-white border-gray-600 hover:bg-gray-400 hover:text-gray-800 active:text-gray-900  active:bg-gray-200 rounded  border-0',
    tertiary:
      'text-gray-500 bg-white hover:text-gray-900 hover:bg-gray-100 active:bg-gray-200 active:text-gray-900',
    danger:
      'text-red-600 focus-visible:bg-red-100 focus-visible:ring-red-600 active:bg-red-200 hover:bg-red-100',
    link: '!p-0 font-semibold text-green-600 focus-visible:ring-transparent focus:underline hover:underline',
    dao: 'flex self-center px-4 py-1 transition-all duration-150 border rounded border-off-300/20 hover:bg-off-300 hover:text-gray-900',
    outline:
      ' hover:text-stone-200 hover:bg-red-700 active:bg-gray-200 active:text-gray-900 rounded border border-yellow-700 hover:shadow-red-800 shadow-lg hover:text-yellow-100',
    unstyled: '',
  },
} as const;

export const getButtonStyles = () => STYLES;

export interface Styles {
  size?: keyof (typeof STYLES)['size']['base'];
  variant?: keyof (typeof STYLES)['variant'];
  fullWidth?: boolean;
}

export type ButtonOrLinkProps = {
  preserveRedirect?: boolean;
  replace?: boolean;
  leftIcon?: ReactElement;
  rightIcon?: ReactElement;
  isIconButton?: boolean;
  loading?: boolean;
  loadingText?: string;
  spinner?: ReactElement;
  texture?: boolean;
} & ComponentPropsWithRef<'button'> &
  ComponentPropsWithRef<'a'> &
  Styles;

export const ButtonOrLink = forwardRef<
  HTMLButtonElement & HTMLAnchorElement,
  PropsWithChildren<ButtonOrLinkProps>
>(
  (
    {
      href,
      replace = false,
      preserveRedirect = false,
      size = 'md',
      variant = 'default',
      isIconButton = false,
      fullWidth = false,
      loading = false,
      loadingText,
      spinner = <Spinner variant="circle" size="sm" />,
      className,
      texture = true,
      children,
      leftIcon,
      rightIcon,
      disabled,
      ...props
    },
    ref
    // eslint-disable-next-line sonarjs/cognitive-complexity
  ) => {
    const router = useRouter();
    const isLink = typeof href !== 'undefined';
    const ButtonOrLink = isLink ? 'span' : 'button';

    const classes =
      variant === 'unstyled'
        ? className
        : clsx(
            STYLES.base,
            STYLES.disabled,
            STYLES.active,
            isIconButton ? STYLES.icon : STYLES.variant[variant],
            isIconButton ? STYLES.size.icon[size] : STYLES.size.base[size],
            fullWidth && 'w-full'
          );

    const content = (
      <ButtonOrLink
        ref={ref}
        className={twMerge(classes, className)}
        disabled={disabled || loading}
        {...props}
      >
        {variant == 'primary' && (
          <div className={`absolute flex right-0 left-0 h-full w-full`}>
            <svg
              className="fill-yellow-secondary"
              viewBox="0 0 75 148"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M41 141.828V143.823H33L23 132.851C21.9532 130.108 22.3891 128.321 22.744 126.867C23.0989 125.412 23.3727 124.289 22 122.876V121.879H23C23.5148 121.982 23.7656 122.339 24.1327 122.863C24.5044 123.393 24.9953 124.093 26 124.871C29.8769 127.873 30.2102 129.682 30.6121 131.865C30.9051 133.456 31.2347 135.245 33 137.838C33.6457 138.786 35.1921 139.428 36.7217 140.063C38.0086 140.597 39.2835 141.126 40 141.828H41ZM67 135.843C66.79 142.159 63.744 143.399 58 143.823C57.6412 142.865 57.6209 142.671 57.5352 142.512C57.4668 142.385 57.3568 142.28 57 141.828C55.0072 140.867 52.2801 140.462 49.3857 140.032C44.9775 139.377 40.1812 138.664 37 135.843C36.6522 135.457 36.3198 134.894 35.9881 134.332C35.6626 133.781 35.3378 133.232 35 132.851V130.856C38.9807 131.478 41.5079 132.945 44.0609 134.427C46.3372 135.748 48.6341 137.081 52 137.838C54.991 134.746 60.43 132.434 65 135.843H67ZM22.2354 135.44C23.6202 137.11 24.9122 138.668 24 140.831C23.5665 140.496 22.7669 140.155 21.9715 139.815C21.196 139.484 20.4245 139.155 20 138.836C13.3243 136.209 13.4209 130.165 13.5269 123.537C13.5944 119.32 13.6656 114.867 12 110.906C11.3933 109.464 10.031 108.105 8.6323 106.709C6.06997 104.153 3.38539 101.475 5 97.9393V93.9494H6C7.72783 97.3886 10.0213 100.597 12.3081 103.797C15.3192 108.01 18.3188 112.206 20 116.891C21.0512 119.821 20.5821 122.507 20.1279 125.108C19.73 127.386 19.3435 129.599 20 131.853C20.3998 133.226 21.3371 134.357 22.2354 135.44ZM73.6108 137.654C73.7202 137.803 73.5679 138.144 74 139.833H71C71.3588 138.876 71.3791 138.681 71.4648 138.522C71.5332 138.395 71.6432 138.29 72 137.838V136.841C73.1906 137.543 73.5106 137.518 73.6108 137.654ZM6.50945 109.89C8.71284 114.093 12.0968 120.548 8 124.871C7.58144 123.981 7.17259 122.902 6.74522 121.773C5.95348 119.683 5.09821 117.425 4 115.894V108.912H6C6.15891 109.221 6.33027 109.548 6.50945 109.89ZM10 74H74.4084V147.813C68.9645 147.813 63.5196 147.86 58.0745 147.906C47.1838 148 36.2925 148.094 25.4084 147.813C17.0914 145.046 11.9664 139.545 10.4084 132.851C8.8953 130.886 7.54116 129.685 6.31595 128.598C4.40424 126.903 2.80641 125.486 1.4084 121.879C-0.499873 116.956 -0.0189926 94.3577 0.292853 79.7031C0.337258 77.6163 0.378236 75.6906 0.4084 74H6.98632C6.90881 82.0409 7.63615 89.2227 9 94.9469H10V74ZM4.53522 91.2708C4.46683 91.3979 4.3568 91.5025 4 91.9545V89.9595H5C4.64124 90.9171 4.62094 91.1116 4.53522 91.2708Z"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M74.4084 74V0.187081C68.9645 0.187081 63.5196 0.140314 58.0745 0.0935445C47.1838 2.54533e-06 36.2925 -0.0935445 25.4084 0.187081C17.0914 2.95407 11.9664 8.45513 10.4084 15.1492C8.8953 17.1143 7.54116 18.3152 6.31595 19.4018C4.40424 21.0972 2.80641 22.5142 1.4084 26.1214C-0.499873 31.0441 -0.0189926 53.6423 0.292853 68.2969C0.337258 70.3837 0.378236 72.3094 0.4084 74H6.98827C6.89758 65.8834 7.62558 58.6346 9 52.866H10V74H74.4084ZM41 3.98989H33L23 14.9621C21.9532 17.7047 22.3891 19.4918 22.744 20.9464C23.0989 22.4014 23.3727 23.5237 22 24.9368V25.9343H23C23.5148 25.8312 23.7656 25.4734 24.1327 24.9499C24.5044 24.4198 24.9953 23.7197 26 22.9419C29.8769 19.9402 30.2102 18.1307 30.6121 15.9483C30.9051 14.3574 31.2347 12.5683 33 9.97472C33.6457 9.02674 35.1921 8.38501 36.7217 7.75029C38.0086 7.21625 39.2835 6.68718 40 5.98483H41V3.98989ZM67 11.9697C66.79 5.65367 63.744 4.41381 58 3.98989C57.6412 4.94749 57.6209 5.14194 57.5352 5.30118C57.4668 5.42823 57.3568 5.53287 57 5.98483C55.0072 6.94552 52.2801 7.35089 49.3857 7.78112C44.9775 8.43637 40.1812 9.14931 37 11.9697C36.6522 12.3563 36.3198 12.9191 35.9881 13.4805C35.6626 14.0315 35.3378 14.5812 35 14.9621V16.957C38.9807 16.3348 41.5079 14.8679 44.0609 13.3861C46.3372 12.0648 48.6341 10.7317 52 9.97472C54.991 13.0669 60.43 15.379 65 11.9697H67ZM22.2354 12.3728C23.6202 10.7028 24.9122 9.14452 24 6.9823C23.5665 7.31668 22.7669 7.65796 21.9714 7.99747C21.196 8.32842 20.4245 8.6577 20 8.97725C13.3243 11.6043 13.4209 17.6477 13.5269 24.2762C13.5944 28.4925 13.6656 32.9454 12 36.9065C11.3933 38.3488 10.031 39.708 8.6323 41.1035C6.06996 43.6599 3.38539 46.3383 5 49.8736V53.8635H6C7.72783 50.4243 10.0213 47.2156 12.3081 44.0162C15.3192 39.8033 18.3188 35.6067 20 30.9216C21.0512 27.9923 20.5821 25.3062 20.1279 22.7051C19.73 20.4268 19.3435 18.2137 20 15.9595C20.3998 14.5866 21.3371 13.4562 22.2354 12.3728ZM73.6108 10.159C73.7202 10.0101 73.5679 9.6689 74 7.97978H71C71.3588 8.93737 71.3791 9.13182 71.4648 9.29106C71.5332 9.41812 71.6432 9.52276 72 9.97472V10.9722C73.1906 10.2701 73.5106 10.2953 73.6108 10.159ZM6.50945 37.923C8.71284 33.7198 12.0968 27.2645 8 22.9419C7.58144 23.8318 7.17259 24.9112 6.74522 26.0394C5.95348 28.1297 5.09821 30.3877 4 31.9191V38.9014H6C6.15891 38.5917 6.33028 38.2648 6.50945 37.923ZM4.53522 56.5421C4.46683 56.415 4.3568 56.3104 4 55.8584V57.8534H5C4.64124 56.8958 4.62094 56.7013 4.53522 56.5421Z"
              />
            </svg>

            <div className="relative flex-1 h-full -mx-[1px] bg-yellow-secondary">
              <div
                className={clsx(
                  'absolute left-0 w-full h-[0.5px] bg-black',
                  size == 'lg' ? 'top-[2px]' : 'top-[1.5px]'
                )}
              ></div>
              <div
                className={clsx(
                  'absolute left-0 w-full h-[0.5px] bg-black',
                  size == 'lg' ? 'bottom-[2px]' : 'bottom-[1.5px]'
                )}
              ></div>
            </div>
            <svg
              className="fill-yellow-secondary"
              viewBox="0 0 75 148"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M33.4084 141.82V143.818H41.4084L51.4084 132.832C52.4552 130.086 52.0193 128.296 51.6644 126.84C51.3095 125.383 51.0357 124.259 52.4084 122.844V121.846H51.4084C50.8936 121.949 50.6428 122.307 50.2757 122.831C49.904 123.362 49.4131 124.063 48.4084 124.842C44.5315 127.847 44.1982 129.659 43.7963 131.844C43.5033 133.437 43.1737 135.228 41.4084 137.825C40.7627 138.774 39.2163 139.417 37.6867 140.053C36.3998 140.587 35.1249 141.117 34.4084 141.82H33.4084ZM7.4084 135.828C7.6184 142.152 10.6644 143.393 16.4084 143.818C16.7672 142.859 16.7875 142.664 16.8732 142.505C16.9416 142.378 17.0516 142.273 17.4084 141.82C19.4012 140.858 22.1283 140.452 25.0227 140.022C29.4309 139.366 34.2272 138.652 37.4084 135.828C37.7562 135.441 38.0886 134.877 38.4203 134.315C38.7458 133.763 39.0706 133.213 39.4084 132.832V130.834C35.4277 131.457 32.9005 132.926 30.3475 134.41C28.0712 135.733 25.7743 137.067 22.4084 137.825C19.4174 134.729 13.9784 132.414 9.4084 135.828H7.4084ZM52.173 135.424C50.7882 137.096 49.4962 138.657 50.4084 140.822C50.8419 140.487 51.6415 140.145 52.4369 139.805C53.2124 139.474 53.9839 139.144 54.4084 138.824C61.0841 136.194 60.9875 130.143 60.8815 123.506C60.814 119.284 60.7428 114.826 62.4084 110.859C63.0151 109.415 64.3774 108.054 65.7761 106.657C68.3384 104.097 71.023 101.416 69.4084 97.876V93.881H68.4084C66.6806 97.3245 64.3871 100.537 62.1003 103.741C59.0892 107.959 56.0896 112.161 54.4084 116.852C53.3572 119.785 53.8263 122.474 54.2805 125.079C54.6784 127.36 55.0649 129.576 54.4084 131.833C54.0086 133.208 53.0713 134.339 52.173 135.424ZM0.797638 137.641C0.688126 137.79 0.840561 138.131 0.408401 139.823H3.4084C3.04961 138.864 3.02934 138.669 2.9436 138.51C2.87521 138.383 2.76517 138.278 2.4084 137.825V136.827C1.21801 137.529 0.897942 137.504 0.797638 137.641ZM67.8989 109.842C65.6956 114.05 62.3116 120.514 66.4084 124.842C66.827 123.951 67.2358 122.87 67.6632 121.74C68.4549 119.647 69.3102 117.387 70.4084 115.853V108.862H68.4084C68.2495 109.172 68.0781 109.499 67.8989 109.842ZM64.4084 73.9063H-5.47045e-09V147.813C5.44386 147.813 10.8888 147.86 16.3339 147.906C27.2246 148 38.1159 148.094 49 147.813C57.317 145.042 62.442 139.534 64 132.832C65.5131 130.864 66.8672 129.662 68.0925 128.574C70.0042 126.876 71.602 125.457 73 121.846C74.9083 116.917 74.4274 94.2898 74.1155 79.6166C74.0711 77.5272 74.0302 75.5991 74 73.9063H67.4221C67.4996 81.9575 66.7723 89.1483 65.4084 94.8798H64.4084V73.9063ZM69.8732 91.1991C69.9416 91.3263 70.0516 91.4311 70.4084 91.8835V89.8861H69.4084C69.7672 90.845 69.7875 91.0396 69.8732 91.1991Z"
              />
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M-1.4396e-08 74.0937V0.187318C5.44386 0.187318 10.8888 0.140491 16.3339 0.0936629C27.2246 2.54533e-06 38.1159 -0.0936629 49 0.187318C57.317 2.95781 62.442 8.46583 64 15.1683C65.5131 17.1359 66.8672 18.3384 68.0925 19.4263C70.0042 21.1239 71.602 22.5427 73 26.1544C74.9083 31.0834 74.4274 53.7102 74.1155 68.3834C74.0711 70.4727 74.0302 72.4009 74 74.0937H67.4201C67.5108 65.9667 66.7828 58.7088 65.4084 52.9329H64.4084V74.0937H-1.4396e-08ZM33.4084 3.99494H41.4084L51.4084 14.981C52.4552 17.7271 52.0193 19.5165 51.6644 20.9729C51.3095 22.4297 51.0357 23.5534 52.4084 24.9684V25.9671H51.4084C50.8936 25.8639 50.6428 25.5057 50.2757 24.9815C49.904 24.4507 49.4131 23.7497 48.4084 22.9709C44.5315 19.9654 44.1982 18.1536 43.7963 15.9685C43.5033 14.3755 43.1737 12.5842 41.4084 9.98734C40.7627 9.03817 39.2163 8.39563 37.6867 7.7601C36.3998 7.22539 35.1249 6.69564 34.4084 5.99241H33.4084V3.99494ZM7.4084 11.9848C7.6184 5.66083 10.6644 4.4194 16.4084 3.99494C16.7672 4.95383 16.7875 5.14848 16.8732 5.30793C16.9416 5.43512 17.0516 5.53992 17.4084 5.99241C19.4012 6.95431 22.1283 7.36019 25.0227 7.79097C29.4309 8.44705 34.2272 9.16089 37.4084 11.9848C37.7562 12.3719 38.0886 12.9354 38.4203 13.4976C38.7458 14.0492 39.0706 14.5996 39.4084 14.981V16.9785C35.4277 16.3555 32.9005 14.8867 30.3475 13.403C28.0712 12.0801 25.7743 10.7453 22.4084 9.98734C19.4174 13.0834 13.9784 15.3985 9.4084 11.9848H7.4084ZM52.173 12.3884C50.7882 10.7163 49.4962 9.1561 50.4084 6.99114C50.8419 7.32594 51.6415 7.66765 52.437 8.00759C53.2124 8.33896 53.9839 8.66865 54.4084 8.98861C61.0841 11.619 60.9875 17.6701 60.8815 24.3069C60.814 28.5285 60.7428 32.9871 62.4084 36.9532C63.0151 38.3974 64.3774 39.7582 65.7761 41.1555C68.3384 43.7152 71.023 46.3969 69.4084 49.9367V53.9317H68.4084C66.6806 50.4881 64.3871 47.2753 62.1003 44.0719C59.0892 39.8537 56.0896 35.6518 54.4084 30.9608C53.3572 28.0277 53.8263 25.3382 54.2805 22.7338C54.6784 20.4527 55.0649 18.2368 54.4084 15.9797C54.0086 14.6051 53.0713 13.4732 52.173 12.3884ZM0.797638 10.1719C0.688126 10.0229 0.840561 9.6814 0.408401 7.98987H3.4084C3.04961 8.94877 3.02934 9.14342 2.9436 9.30287C2.87521 9.43006 2.76517 9.53486 2.4084 9.98734V10.9861C1.21801 10.2833 0.897942 10.3083 0.797638 10.1719ZM67.8989 37.971C65.6956 33.7625 62.3116 27.299 66.4084 22.9709C66.827 23.8619 67.2358 24.9427 67.6632 26.0724C68.4549 28.1653 69.3102 30.4261 70.4084 31.9595V38.9506H68.4084C68.2495 38.6406 68.0781 38.3133 67.8989 37.971ZM69.8732 56.6136C69.9416 56.4864 70.0516 56.3816 70.4084 55.9291V57.9266H69.4084C69.7672 56.9677 69.7875 56.773 69.8732 56.6136Z"
              />
            </svg>
          </div>
        )}

        {(leftIcon || loading) && (
          <span className="mr-3.5">{loading ? spinner : leftIcon}</span>
        )}
        <span className="z-10 inline-flex">
          {loading ? loadingText || children : children}
        </span>
        {rightIcon && <span className="ml-3.5">{rightIcon}</span>}
      </ButtonOrLink>
    );

    if (isLink) {
      const finalHref =
        preserveRedirect && router.query.redirect
          ? `${href!}?redirect=${encodeURIComponent(
              router.query.redirect as string
            )}`
          : href!;

      return (
        <Link href={finalHref} passHref replace target={props.target}>
          {content}
        </Link>
      );
    }

    return content;
  }
);

ButtonOrLink.displayName = 'ButtonOrLink';
